<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Bitcoin Retirement Calculator</title>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      /* ——— General layout & typography ——— */
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        line-height: 1.6;
        background-color: #fafafa;
        color: #333;
      }

      /* Flex container for inputs + summary */
      .input-summary-container {
        display: flex;
        gap: 20px;
        align-items: flex-start;
      }
      #inputArea,
      #summary {
        flex: 1;
        min-width: 300px;
      }

      /* Form controls */
      select,
      input,
      button.update-button {
        margin-bottom: 10px;
        padding: 5px;
        width: 250px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      button.update-button {
        width: auto;
        cursor: pointer;
        background-color: #4caf50;
        color: white;
      }
      label {
        display: inline-block;
        width: 350px;
        vertical-align: top;
        margin-bottom: 5px;
      }

      /* Tooltip question‑mark buttons */
      .tooltip-button {
        margin-left: 5px;
        color: darkorange;
        cursor: pointer;
        font-size: 1em;
        background: none;
        border: none;
        padding: 0;
      }
      .tooltip-button:focus {
        outline: none;
      }
      /* Custom tooltip (mobile‑friendly) */
      .custom-tooltip {
        position: absolute;
        background-color: #333;
        color: #fff;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.8em;
        z-index: 1000;
        max-width: 150px;
        word-wrap: break-word;
      }

      /* Buttons */
      button {
        padding: 10px 20px;
        margin-top: 10px;
        border: none;
        border-radius: 4px;
        background-color: #4caf50;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background-color: #45a049;
      }

      /* Tables */
      table {
        border-collapse: collapse;
        margin-top: 20px;
        width: 100%;
        background-color: #fff;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 8px 10px;
        text-align: center;
      }
      th {
        background-color: #f0f0f0;
      }
      .summary-table {
        max-width: 500px;
        margin-top: 20px;
      }
      .retirement-table {
        width: 100%;
        max-width: none;
      }
      .summary-table td {
        text-align: left;
        padding: 6px;
      }

      /* Misc */
      .hint {
        font-size: 0.9em;
        color: #555;
      }
      .currency-label {
        font-weight: bold;
      }
      #result,
      #retirementSummary {
        width: 100%;
      }
      #retirementSummary {
        margin-top: 40px;
        max-width: none;
      }
      .warning {
        color: red;
        font-weight: bold;
        margin-bottom: 10px;
      }
      #chartContainer {
        margin-top: 20px;
      }
      #retirementChart {
        height: 200px !important;
      }
      #explanation {
        margin-bottom: 20px;
        padding: 10px;
        background-color: #e9f5ff;
        border: 1px solid #b3d7ff;
        border-radius: 4px;
      }
    </style>

    <script>
      /* ——— Utility: locale & currency formatting ——— */
      var currentCurrency = "USD";

      function getLocaleForCurrency(currency) {
        if (currency === "USD") return "en-US";
        if (currency === "EUR") return "de-DE";
        if (currency === "PLN") return "pl-PL";
        return "en-US";
      }

      function formatCurrency(num) {
        var locale = getLocaleForCurrency(currentCurrency);
        return (
          parseFloat(num).toLocaleString(locale, {
            minimumFractionDigits: 0,
            maximumFractionDigits: 0,
          }) +
          " " +
          currentCurrency
        );
      }

      function updateCurrencyLabels() {
        document.querySelectorAll(".currency-label").forEach(function (span) {
          span.innerText = currentCurrency;
        });
      }

      /* ——— Fetch BTC spot price ——— */
      function updatePrice() {
        fetch(
          "https://api.coinbase.com/v2/prices/spot?currency=" + currentCurrency
        )
          .then((res) => {
            if (!res.ok) throw new Error("Network error");
            return res.json();
          })
          .then((data) => {
            var returnedCurrency = data.data.currency;
            var usdPrice = Math.round(parseFloat(data.data.amount));
            var finalPrice = usdPrice;

            if (returnedCurrency !== currentCurrency) {
              if (currentCurrency === "EUR")
                finalPrice = Math.round(usdPrice * 0.96);
              else if (currentCurrency === "PLN")
                finalPrice = Math.round(usdPrice * 4);
            }
            document.getElementById("currentPrice").value = finalPrice;
          })
          .catch((err) => {
            console.error("Error fetching price:", err);
            // Fallback to USD then convert
            fetch("https://api.coinbase.com/v2/prices/spot?currency=USD")
              .then((res) => res.json())
              .then((data) => {
                var usdPrice = Math.round(parseFloat(data.data.amount));
                var finalPrice =
                  currentCurrency === "EUR"
                    ? Math.round(usdPrice * 0.96)
                    : currentCurrency === "PLN"
                    ? Math.round(usdPrice * 4)
                    : usdPrice;
                document.getElementById("currentPrice").value = finalPrice;
              })
              .catch((err) => {
                console.error("Fallback USD fetch failed:", err);
                alert("Unable to fetch Bitcoin price.");
              });
          });
      }

      /* ——— DOM ready setup ——— */
      document.addEventListener("DOMContentLoaded", function () {
        var currencySelect = document.getElementById("currencySelect");
        currentCurrency = currencySelect.value;
        updateCurrencyLabels();
        updatePrice();

        // Disallow negatives on money inputs
        document.querySelectorAll(".usd-input").forEach(function (inpt) {
          inpt.addEventListener("input", function () {
            if (this.value < 0) this.value = 0;
          });
        });

        currencySelect.addEventListener("change", function () {
          currentCurrency = this.value;
          updateCurrencyLabels();
        });

        document
          .getElementById("updatePriceButton")
          .addEventListener("click", updatePrice);

        // Mobile‑friendly tooltips
        document.querySelectorAll(".tooltip-button").forEach(function (btn) {
          btn.addEventListener("click", function (e) {
            e.stopPropagation();
            var existing = document.querySelector(".custom-tooltip");
            if (existing) existing.remove();

            var tip = document.createElement("div");
            tip.className = "custom-tooltip";
            tip.innerText = btn.getAttribute("title");
            document.body.appendChild(tip);

            var rect = btn.getBoundingClientRect();
            tip.style.top = rect.bottom + window.scrollY + 5 + "px";
            tip.style.left = rect.left + window.scrollX + "px";

            document.addEventListener("click", function handler() {
              tip.remove();
              document.removeEventListener("click", handler);
            });
          });
        });
      });
    </script>
  </head>

  <body>
    <h1>Bitcoin Retirement Calculator</h1>

    <div id="explanation">
      This app helps you project the growth of your Bitcoin investment during an
      accumulation phase and then simulates your retirement portfolio – taking
      into account monthly investments and subsequent withdrawals. For example,
      if you start with a <span class="currency-label">USD</span>25,000 lump sum
      and invest <span class="currency-label">USD</span>1,000 per month at an
      expected 40% CAGR (with a 5% annual reduction in growth), the app
      calculates your final portfolio value and then projects how long it can
      support your desired monthly pension during retirement. Adjust the
      parameters to see how different scenarios affect your retirement planning.
    </div>

    <!-- ——— Currency selection ——— -->
    <div>
      <label for="currencySelect">Select Currency:</label>
      <select id="currencySelect">
        <option value="USD" selected>USD</option>
        <option value="EUR">EUR</option>
        <option value="PLN">PLN</option>
      </select>
      <button type="button" id="updatePriceButton" class="update-button">
        Update Price
      </button>
    </div>

    <!-- ——— Input + summary flex container ——— -->
    <div class="input-summary-container">
      <!-- ===== User Input Area ===== -->
      <div id="inputArea">
        <!-- Accumulation inputs -->
        <div>
          <label for="currentPrice">
            Current Bitcoin Price (<span class="currency-label">USD</span>):
            <button
              type="button"
              class="tooltip-button"
              title="Fetched from Coinbase spot API and rounded to the nearest unit."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            class="usd-input"
            id="currentPrice"
            placeholder="e.g. 95000"
            step="any"
            min="1"
            max="1000000"
          />
        </div>

        <div>
          <label for="expectedCAGR">
            Expected Future CAGR (%)
            <button
              type="button"
              class="tooltip-button"
              title="Historical 5‑yr CAGR ≈56%, 10‑yr ≈82%."
            >
              ?
            </button>
            <span class="hint">(hist 5‑yr 56%, 10‑yr 82%)</span>
          </label>
          <input
            type="number"
            id="expectedCAGR"
            placeholder="e.g. 35"
            step="any"
            value="35"
            min="-100"
            max="200"
          />
        </div>

        <div>
          <label for="yearlyCAGRChange">
            Yearly CAGR Change (relative %)
            <button
              type="button"
              class="tooltip-button"
              title="5 means the CAGR is reduced by 5 % each year."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            id="yearlyCAGRChange"
            placeholder="e.g. 5"
            step="any"
            value="5"
            min="0"
            max="100"
          />
        </div>

        <div>
          <label for="initialAllocation">
            Initial Allocation (<span class="currency-label">USD</span>):
            <button
              type="button"
              class="tooltip-button"
              title="Lump‑sum investment today."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            class="usd-input"
            id="initialAllocation"
            placeholder="e.g. 10000"
            step="any"
            value="10000"
            min="0"
            max="1000000000"
          />
        </div>

        <div>
          <label for="monthlyPurchase">
            Monthly Purchase (<span class="currency-label">USD</span>):
            <button
              type="button"
              class="tooltip-button"
              title="Recurring monthly contribution."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            class="usd-input"
            id="monthlyPurchase"
            placeholder="e.g. 1000"
            step="any"
            value="1000"
            min="0"
            max="1000000"
          />
        </div>

        <div>
          <label for="monthlyPurchaseChange">
            Yearly Change in Monthly Purchase (%):
            <button
              type="button"
              class="tooltip-button"
              title="0 = no change, positive = increase, negative = decrease."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            id="monthlyPurchaseChange"
            placeholder="e.g. 0"
            step="any"
            value="0"
            min="-100"
            max="100"
          />
        </div>

        <!-- ——— UPDATED FIELD ——— -->
        <div>
          <label for="years">
            Number of Years to Invest:
            <button
              type="button"
              class="tooltip-button"
              title="Total years of accumulation. Enter 0 for immediate retirement (skip accumulation)."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            id="years"
            placeholder="e.g. 5"
            step="1"
            value="5"
            min="0"
            max="100"
          />
        </div>
        <!-- ———————————————— -->

        <!-- Retirement inputs -->
        <div>
          <label for="desiredPension">
            Desired Monthly Pension (<span class="currency-label">USD</span>):
            <button
              type="button"
              class="tooltip-button"
              title="Monthly withdrawal during retirement."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            class="usd-input"
            id="desiredPension"
            placeholder="e.g. 2000"
            step="any"
            value="2000"
            min="0"
            max="100000"
          />
        </div>

        <div>
          <label for="pensionChange">
            Yearly Change in Monthly Pension (%):
            <button
              type="button"
              class="tooltip-button"
              title="Inflation adjustment or lifestyle change."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            id="pensionChange"
            placeholder="e.g. 2"
            step="any"
            value="2"
            min="-100"
            max="100"
          />
        </div>

        <div>
          <label for="retirementYears">
            Number of Retirement Years:
            <button
              type="button"
              class="tooltip-button"
              title="Projection horizon for withdrawals."
            >
              ?
            </button>
          </label>
          <input
            type="number"
            id="retirementYears"
            placeholder="e.g. 15"
            step="1"
            value="15"
            min="1"
            max="100"
          />
        </div>

        <button onclick="calculate()">Calculate</button>
      </div>

      <!-- ===== Accumulation summary ===== -->
      <div id="summary"></div>
    </div>

    <!-- Accumulation breakdown table -->
    <div id="result">
      <h2>Yearly Investment Breakdown</h2>
      <table id="resultTable">
        <thead>
          <tr>
            <th title="Year 0 = initial lump sum">Year</th>
            <th>
              Bitcoin Price (<span class="currency-label">USD</span>) (Mkcap)
            </th>
            <th>Bitcoin Purchased (BTC)</th>
            <th>Value (<span class="currency-label">USD</span>)</th>
            <th>Current CAGR (%)</th>
            <th>Monthly Purchase (<span class="currency-label">USD</span>)</th>
          </tr>
        </thead>
        <tbody id="resultBody"></tbody>
      </table>
    </div>

    <!-- Retirement projection -->
    <div id="retirementSummary"></div>

    <!-- ——— Main calculator logic ——— -->
    <script>
      function calculate() {
        /* Clear previous output */
        document.getElementById("resultBody").innerHTML = "";
        document.getElementById("summary").innerHTML = "";
        document.getElementById("retirementSummary").innerHTML = "";

        /* Create chart placeholder */
        var retirementDiv = document.getElementById("retirementSummary");
        var chartDiv = document.createElement("div");
        chartDiv.id = "chartContainer";
        var canvas = document.createElement("canvas");
        canvas.id = "retirementChart";
        chartDiv.appendChild(canvas);
        retirementDiv.appendChild(chartDiv);

        /* Gather inputs */
        var currentPriceInput = parseFloat(
          document.getElementById("currentPrice").value
        );
        var expectedCAGR = parseFloat(
          document.getElementById("expectedCAGR").value
        );
        var yearlyCAGRChange = parseFloat(
          document.getElementById("yearlyCAGRChange").value
        );
        var initialAllocation = parseFloat(
          document.getElementById("initialAllocation").value
        );
        var monthlyPurchase = parseFloat(
          document.getElementById("monthlyPurchase").value
        );
        var monthlyPurchaseChange = parseFloat(
          document.getElementById("monthlyPurchaseChange").value
        );
        var years = parseInt(document.getElementById("years").value, 10);

        /* Basic validation */
        if (
          [
            currentPriceInput,
            expectedCAGR,
            yearlyCAGRChange,
            initialAllocation,
            monthlyPurchase,
            monthlyPurchaseChange,
            years,
          ].some((x) => isNaN(x))
        ) {
          alert("Please fill in all accumulation fields with valid numbers.");
          return;
        }

        /* Accumulation simulation */
        var price = currentPriceInput;
        var currentCAGR = expectedCAGR;
        var currentMonthlyPurchase = monthlyPurchase;
        var totalBTC = 0;
        var totalInvested = 0;

        /* Year 0 (initial lump sum) */
        var btcPurchased = initialAllocation / price;
        var value = btcPurchased * price;
        totalBTC += btcPurchased;
        totalInvested += initialAllocation;
        addRow(
          0,
          price,
          btcPurchased,
          value,
          "-",
          "-",
          "Year 0 uses your initial allocation at the current price."
        );

        for (var i = 1; i <= years; i++) {
          var startingPrice = price;
          var endPrice = startingPrice * (1 + currentCAGR / 100);
          var avgPrice = (startingPrice + endPrice) / 2;
          var totalInvestmentYear = currentMonthlyPurchase * 12;
          var btcPurchasedYear = totalInvestmentYear / avgPrice;
          var valueYear = btcPurchasedYear * endPrice;

          totalBTC += btcPurchasedYear;
          totalInvested += totalInvestmentYear;

          addRow(
            i,
            startingPrice,
            btcPurchasedYear,
            valueYear,
            currentCAGR.toFixed(2),
            currentMonthlyPurchase,
            "Year " + i + ": monthly purchases use the year's average price."
          );

          /* Update for next loop */
          price = endPrice;
          currentCAGR = currentCAGR * (1 - yearlyCAGRChange / 100);
          currentMonthlyPurchase =
            currentMonthlyPurchase * (1 + monthlyPurchaseChange / 100);
        }

        /* Summary */
        var finalPrice = price;
        var finalInvestmentValue = totalBTC * finalPrice;
        var netGain = finalInvestmentValue - totalInvested;
        var percentageGain = (netGain / totalInvested) * 100;
        createSummaryTable(
          totalInvested,
          totalBTC,
          finalPrice,
          finalInvestmentValue,
          netGain,
          percentageGain
        );

        /* Retirement inputs */
        var desiredPension = parseFloat(
          document.getElementById("desiredPension").value
        );
        var pensionChange = parseFloat(
          document.getElementById("pensionChange").value
        );
        var retirementYears = parseInt(
          document.getElementById("retirementYears").value,
          10
        );
        if (
          [desiredPension, pensionChange, retirementYears].some((x) => isNaN(x))
        ) {
          alert("Please fill in all retirement fields with valid numbers.");
          return;
        }

        var retirementData = simulateRetirement(
          finalInvestmentValue,
          desiredPension,
          pensionChange,
          currentCAGR,
          yearlyCAGRChange,
          retirementYears,
          finalPrice
        );
        createRetirementTable(retirementData);
        createRetirementChart(retirementData);
      }

      /* ——— Helpers to build rows/tables/charts ——— */
      function addRow(
        year,
        currentPrice,
        btcPurchased,
        value,
        cagr,
        monthlyPurchase,
        tooltipText
      ) {
        var tbody = document.getElementById("resultBody");
        var row = document.createElement("tr");

        var yearCell = document.createElement("td");
        yearCell.textContent = year;
        row.appendChild(yearCell);

        /* Market cap calc */
        var priceInUSD =
          currentCurrency === "EUR"
            ? currentPrice / 0.96
            : currentCurrency === "PLN"
            ? currentPrice / 4
            : currentPrice;
        var marketCapT = Math.floor((priceInUSD * 21000000) / 1e12);

        var priceCell = document.createElement("td");
        priceCell.textContent =
          formatCurrency(currentPrice) + " (" + marketCapT + " T USD)";
        row.appendChild(priceCell);

        var btcCell = document.createElement("td");
        btcCell.textContent = btcPurchased.toFixed(8);
        row.appendChild(btcCell);

        var valueCell = document.createElement("td");
        valueCell.textContent = formatCurrency(value);
        row.appendChild(valueCell);

        var cagrCell = document.createElement("td");
        cagrCell.textContent = cagr;
        row.appendChild(cagrCell);

        var monthlyCell = document.createElement("td");
        monthlyCell.textContent =
          typeof monthlyPurchase === "number"
            ? formatCurrency(monthlyPurchase)
            : monthlyPurchase;
        row.appendChild(monthlyCell);

        if (tooltipText) row.title = tooltipText;
        tbody.appendChild(row);
      }

      function createSummaryTable(
        totalInvested,
        totalBTC,
        finalPrice,
        finalInvestmentValue,
        netGain,
        percentageGain
      ) {
        var sumDiv = document.getElementById("summary");
        var header = document.createElement("h2");
        header.textContent = "Accumulation Summary";
        sumDiv.appendChild(header);

        var tbl = document.createElement("table");
        tbl.classList.add("summary-table");
        var tbody = document.createElement("tbody");

        function add(desc, val) {
          var tr = document.createElement("tr");
          tr.innerHTML = "<td>" + desc + "</td><td>" + val + "</td>";
          tbody.appendChild(tr);
        }

        add("Total Invested:", formatCurrency(totalInvested));
        add("Total Bitcoin Purchased (BTC):", totalBTC.toFixed(8));
        add("Final Bitcoin Price:", formatCurrency(finalPrice));
        add("Final Investment Value:", formatCurrency(finalInvestmentValue));
        add("Net Gain:", formatCurrency(netGain));
        add("Percentage Gain (%):", percentageGain.toFixed(0));

        tbl.appendChild(tbody);
        sumDiv.appendChild(tbl);
      }

      function simulateRetirement(
        startPortfolio,
        initialMonthlyPension,
        pensionChange,
        startingRetirementCAGR,
        yearlyCAGRChange,
        retirementYears,
        startingBitcoinPrice
      ) {
        var portfolio = startPortfolio;
        var monthlyPension = initialMonthlyPension;
        var results = [];
        var thisCAGR = startingRetirementCAGR;
        var btcPrice = startingBitcoinPrice;

        for (var yr = 1; yr <= retirementYears; yr++) {
          var startPort = portfolio;
          var mRate = Math.pow(1 + thisCAGR / 100, 1 / 12) - 1;

          for (var m = 0; m < 12; m++) {
            portfolio = portfolio * (1 + mRate) - monthlyPension;
          }

          var withdrawal = monthlyPension * 12;
          var endPort = portfolio;
          results.push({
            year: yr,
            bitcoinPrice: btcPrice,
            startingPortfolio: startPort,
            currentCAGR: thisCAGR,
            monthlyPension: monthlyPension,
            totalWithdrawal: withdrawal,
            annualGrowth: endPort - startPort + withdrawal,
            endingPortfolio: endPort,
          });

          monthlyPension *= 1 + pensionChange / 100;
          thisCAGR *= 1 - yearlyCAGRChange / 100;
          btcPrice *= 1 + thisCAGR / 100;
        }
        return results;
      }

      function createRetirementTable(data) {
        var div = document.getElementById("retirementSummary");

        var runOut = data.find((d) => d.endingPortfolio <= 0);
        if (runOut) {
          var warn = document.createElement("p");
          warn.className = "warning";
          warn.textContent =
            "Warning: portfolio projected to run out after Year " +
            runOut.year +
            ".";
          div.appendChild(warn);
        }

        var h2 = document.createElement("h2");
        h2.textContent = "Retirement Projection";
        div.appendChild(h2);

        var table = document.createElement("table");
        table.classList.add("retirement-table");

        var thead = document.createElement("thead");
        var hdrRow = document.createElement("tr");
        [
          "Year",
          "Bitcoin Price (" + currentCurrency + ") (Mkcap)",
          "Starting Portfolio (" + currentCurrency + ")",
          "Current CAGR (%)",
          "Monthly Pension (" + currentCurrency + ")",
          "Total Annual Withdrawal (" + currentCurrency + ")",
          "Annual Growth (" + currentCurrency + ")",
          "Withdrawal/Growth (%)",
          "Ending Portfolio (" + currentCurrency + ")",
        ].forEach(function (txt) {
          var th = document.createElement("th");
          th.textContent = txt;
          hdrRow.appendChild(th);
        });
        thead.appendChild(hdrRow);
        table.appendChild(thead);

        var tbody = document.createElement("tbody");
        data.forEach(function (d) {
          var tr = document.createElement("tr");

          function td(text) {
            var cell = document.createElement("td");
            cell.textContent = text;
            tr.appendChild(cell);
          }

          td(d.year);

          var priceUSD =
            currentCurrency === "EUR"
              ? d.bitcoinPrice / 0.96
              : currentCurrency === "PLN"
              ? d.bitcoinPrice / 4
              : d.bitcoinPrice;
          var mcapT = Math.floor((priceUSD * 21000000) / 1e12);
          td(
            formatCurrency(d.bitcoinPrice) + " (" + mcapT + "\u00a0T\u00a0USD)"
          );

          td(formatCurrency(d.startingPortfolio));
          td(d.currentCAGR.toFixed(0));
          td(formatCurrency(d.monthlyPension));
          td(formatCurrency(d.totalWithdrawal));
          td(formatCurrency(d.annualGrowth));

          var ratio =
            d.annualGrowth !== 0
              ? ((d.totalWithdrawal / d.annualGrowth) * 100).toFixed(1) + "%"
              : "-";
          td(ratio);

          var endCell = document.createElement("td");
          endCell.textContent = formatCurrency(d.endingPortfolio);
          if (d.endingPortfolio < 0) {
            endCell.style.color = "red";
            endCell.style.fontWeight = "bold";
          }
          tr.appendChild(endCell);

          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        div.appendChild(table);
      }

      function createRetirementChart(data) {
        var labels = data.map((d) => "Year " + d.year);
        var vals = data.map((d) => d.endingPortfolio);

        new Chart(document.getElementById("retirementChart"), {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Ending Portfolio (" + currentCurrency + ")",
                data: vals,
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                borderColor: "rgba(75, 192, 192, 1)",
                borderWidth: 2,
                fill: true,
                tension: 0.1,
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (v) {
                    return (
                      v.toLocaleString(getLocaleForCurrency(currentCurrency), {
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0,
                      }) +
                      " " +
                      currentCurrency
                    );
                  },
                },
              },
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (ctx) {
                    return (
                      ctx.parsed.y.toLocaleString(
                        getLocaleForCurrency(currentCurrency),
                        {
                          minimumFractionDigits: 0,
                          maximumFractionDigits: 0,
                        }
                      ) +
                      " " +
                      currentCurrency
                    );
                  },
                },
              },
            },
          },
        });
      }
    </script>
  </body>
</html>
